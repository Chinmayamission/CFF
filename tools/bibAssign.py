"""
python tools/bulkEmail.py
python -m unittest tools.bibAssign
"""
from tests.integration.constants import _
from chalicelib.util.formSubmit.emailer import display_form_dict, email_to_html_text
import os
os.environ["TABLE_PREFIX"] = "cff_prod"
from chalicelib.main import TABLES
from chalicelib.util import get_all_responses
from boto3.dynamodb.conditions import Key
import boto3
import json
from pynliner import Pynliner
from pydash.objects import get
import datetime

BIBS = {"1": "1", "2": "2", "3": "3", "4": "4", "5": "5", "6": "6", "7": "7", "8": "8", "9": "9", "10": "10", "11": "11", "12": "12", "13": "13", "14": "14", "15": "15", "16": "16", "17": "17", "18": "18", "19": "19", "20": "20", "21": "21", "22": "22", "23": "23", "24": "24", "25": "25", "26": "26", "27": "27", "28": "28", "29": "29", "30": "30", "31": "31", "32": "32", "33": "33", "34": "34", "35": "35", "36": "36", "37": "37", "38": "38", "39": "39", "40": "40", "41": "41", "42": "42", "43": "43", "44": "44", "45": "45", "46": "46", "47": "47", "48": "48", "49": "49", "50": "50", "51": "51", "52": "52", "53": "53", "54": "54", "55": "55", "56": "56", "57": "57", "58": "58", "59": "59", "60": "60", "61": "61", "62": "62", "63": "63", "64": "64", "65": "65", "66": "66", "67": "67", "68": "68", "69": "69", "70": "70", "71": "71", "72": "72", "73": "73", "74": "74", "75": "75", "76": "76", "77": "77", "78": "78", "79": "79", "80": "80", "81": "81", "82": "82", "83": "83", "84": "84", "85": "85", "86": "86", "87": "87", "88": "88", "89": "89", "90": "90", "91": "91", "92": "92", "93": "93", "94": "94", "95": "95", "96": "96", "97": "97", "98": "98", "99": "99", "100": "100", "101": "101", "102": "102", "103": "103", "104": "104", "105": "105", "106": "106", "107": "107", "108": "108", "109": "109", "110": "110", "111": "111", "5000": "5001", "5001": "5002", "5002": "5003", "5003": "5004", "5004": "5005", "5005": "5006", "5006": "5007", "5007": "5008", "5008": "5009", "5009": "5010", "5010": "5011", "5011": "5012", "5012": "5013", "5013": "5014", "5014": "5015", "5015": "5016", "5016": "5017", "5017": "5018", "5018": "5019", "5019": "5020", "5020": "5021", "5021": "5022", "5022": "5023", "5023": "5024", "5024": "5025", "5025": "5026", "5026": "5027", "5027": "5028", "5028": "5029", "5029": "5030", "5030": "5031", "5031": "5032", "5032": "5033", "5033": "5034", "5034": "5035", "5035": "5036", "5036": "5037", "5037": "5038", "5038": "5039", "5039": "5040", "5040": "5041", "5041": "5042", "5042": "5043", "5043": "5044", "5045": "5045", "5047": "5046", "5048": "5047", "5049": "5048", "5050": "5049", "5051": "5050", "5052": "5051", "5053": "5052", "5054": "5053", "5055": "5054", "5056": "5055", "5057": "5056", "5058": "5057", "5059": "5058", "5060": "5059", "5061": "5060", "5062": "5061", "5063": "5062", "5065": "5063", "5066": "5064", "5067": "5065", "5068": "5066", "5069": "5067", "5071": "5068", "5072": "5069", "5073": "5070", "5074": "5071", "5075": "5072", "5076": "5073", "5077": "5074", "5078": "5075", "5079": "5076", "5080": "5077", "5081": "5078", "5082": "5079", "5083": "5080", "5084": "5081", "5085": "5082", "5086": "5083", "5087": "5084", "5088": "5085", "5089": "5086", "5090": "5087", "5091": "5088", "5092": "5089", "5093": "5090", "5095": "5091", "5096": "5092", "5101": "5093", "5102": "5094", "5103": "5095", "5104": "5096", "5105": "5097", "5106": "5098", "5107": "5099", "5110": "5100", "5111": "5101", "5112": "5102", "5113": "5103", "5114": "5104", "5115": "5105", "5116": "5106", "5117": "5107", "5118": "5108", "5119": "5109", "5120": "5110", "5121": "5111", "5125": "5112", "5126": "5113", "5127": "5114", "5128": "5115", "5129": "5116", "5130": "5117", "5131": "5118", "5132": "5119", "5133": "5120", "5136": "5121", "5137": "5122", "5138": "5123", "5139": "5124", "5140": "5125", "5141": "5126", "5142": "5127", "5143": "5128", "5144": "5129", "5145": "5130", "5146": "5131", "5147": "5132", "5148": "5133", "5149": "5134", "5150": "5135", "5151": "5136", "5152": "5137", "5153": "5138", "5154": "5139", "5157": "5140", "5158": "5141", "5159": "5142", "5160": "5143", "5162": "5144", "5163": "5145", "5164": "5146", "5168": "5147", "5169": "5148", "5170": "5149", "5171": "5150", "5172": "5151", "5173": "5152", "5174": "5153", "5175": "5154", "5176": "5155", "5177": "5156", "5178": "5157", "5179": "5158", "5180": "5159", "5181": "5160", "5182": "5161", "5183": "5162", "5184": "5163", "5185": "5164", "5186": "5165", "5187": "5166", "5188": "5167", "5189": "5168", "5190": "5169", "5191": "5170", "5192": "5171", "5193": "5172", "5194": "5173", "5195": "5174", "5196": "5175", "5197": "5176", "5198": "5177", "5199": "5178", "5200": "5179", "5201": "5180", "5202": "5181", "5203": "5182", "5204": "5183", "5205": "5184", "5206": "5185", "5207": "5186", "5208": "5187", "5209": "5188", "5211": "5189", "5213": "5190", "5214": "5191", "5215": "5192", "5216": "5193", "5217": "5194", "5218": "5195", "5219": "5196", "5220": "5197", "5221": "5198", "5222": "5199", "5223": "5200", "5224": "5201", "5225": "5202", "5226": "5203", "5227": "5204", "5228": "5205", "5229": "5206", "5230": "5207", "5231": "5208", "5232": "5209", "5233": "5210", "5234": "5211", "5235": "5212", "5236": "5213", "5237": "5214", "5238": "5215", "5239": "5216", "5240": "5217", "5242": "5218", "5243": "5219", "5244": "5220", "5245": "5221", "5246": "5222", "5247": "5223", "5248": "5224", "5249": "5225", "5250": "5226", "5251": "5227", "5252": "5228", "5253": "5229", "5254": "5230", "5255": "5231", "5256": "5232", "5257": "5233", "5258": "5234", "5259": "5235", "5260": "5236", "5261": "5237", "5262": "5238", "5263": "5239", "5264": "5240", "5265": "5241", "5266": "5242", "5267": "5243", "5268": "5244", "5269": "5245", "5270": "5246", "5271": "5247", "5272": "5248", "5273": "5249", "5274": "5250", "5275": "5251", "5276": "5252", "5277": "5253", "5278": "5254", "5279": "5255", "5280": "5256", "5281": "5257", "5282": "5258", "5283": "5259", "5284": "5260", "5285": "5261", "5286": "5262", "5287": "5263", "5288": "5264", "5289": "5265", "5290": "5266", "5291": "5267", "5292": "5268", "5293": "5269", "5294": "5270", "5295": "5271", "5296": "5272", "5297": "5273", "5298": "5274", "5302": "5275", "5303": "5276", "5304": "5277", "5305": "5278", "5306": "5279", "5307": "5280", "5308": "5281", "5309": "5282", "5310": "5283", "5311": "5284", "5313": "5285", "5314": "5286", "5315": "5287", "5316": "5288", "5317": "5289", "5318": "5290", "5319": "5291", "5320": "5292", "5321": "5293", "5323": "5294", "5324": "5295", "5325": "5296", "5326": "5297", "5327": "5298", "5328": "5299", "5329": "5300", "5330": "5301", "5331": "5302", "5332": "5303", "5333": "5304", "5334": "5305", "5335": "5306", "5337": "5307", "5338": "5308", "5339": "5309", "5340": "5310", "5341": "5311", "5342": "5312", "5343": "5313", "5344": "5314", "5345": "5315", "5346": "5316", "5347": "5317", "5348": "5318", "5350": "5319", "5351": "5320", "5353": "5321", "5354": "5322", "5355": "5323", "5356": "5324", "5359": "5325", "5360": "5326", "5361": "5327", "5362": "5328", "5363": "5329", "5364": "5330", "5365": "5331", "5366": "5332", "5367": "5333", "5368": "5334", "5369": "5335", "5370": "5336", "5371": "5337", "5372": "5338", "5373": "5339", "5374": "5340", "5375": "5341", "5376": "5342", "5377": "5343", "5378": "5344", "5379": "5345", "5380": "5346", "5381": "5347", "5382": "5348", "5383": "5349", "5384": "5350", "5385": "5351", "5386": "5352", "5387": "5353", "5388": "5354", "5389": "5355", "5390": "5356", "5391": "5357", "5392": "5358", "5393": "5359", "5394": "5360", "5395": "5361", "5396": "5362", "5397": "5363", "5398": "5364", "5399": "5365", "5400": "5366", "5401": "5367", "5402": "5368", "5403": "5369", "5404": "5370", "5405": "5371", "5406": "5372", "5407": "5373", "5408": "5374", "5409": "5375", "5410": "5376", "5411": "5377", "5412": "5378", "5413": "5379", "5414": "5380", "5415": "5381", "5416": "5382", "5417": "5383", "5418": "5384", "5419": "5385", "5420": "5386", "5421": "5387", "5422": "5388", "5423": "5389", "5424": "5390", "5425": "5391", "5426": "5392", "5427": "5393", "5428": "5394", "5429": "5395", "5430": "5396", "5431": "5397", "5432": "5398", "5433": "5399", "5434": "5400", "5435": "5401", "5436": "5402", "5437": "5403", "5438": "5404", "5439": "5405", "5440": "5406", "5441": "5407", "5442": "5408", "5443": "5409", "5444": "5410", "5445": "5411", "5446": "5412", "5447": "5413", "5448": "5414", "5449": "5415", "5450": "5416", "5451": "5417", "5452": "5418", "5453": "5419", "5454": "5420", "5455": "5421", "5456": "5422", "5457": "5423", "5458": "5424", "5459": "5425", "5460": "5426", "5461": "5427", "5462": "5428", "5463": "5429", "5464": "5430", "5465": "5431", "5466": "5432", "5467": "5433", "5468": "5434", "5469": "5435", "5470": "5436", "5472": "5437", "5473": "5438", "5474": "5439", "5475": "5440", "5476": "5441", "5477": "5442", "5478": "5443", "5479": "5444", "5480": "5445", "5481": "5446", "5482": "5447", "5483": "5448", "5484": "5449", "5485": "5450", "5486": "5451", "5487": "5452", "5488": "5453", "5489": "5454", "5490": "5455", "5491": "5456", "5492": "5457", "5493": "5458", "5494": "5459", "5497": "5460", "5498": "5461", "5499": "5462", "5500": "5463", "5501": "5464", "5502": "5465", "5503": "5466", "5504": "5467", "5505": "5468", "5506": "5469", "5507": "5470", "5508": "5471", "5509": "5472", "5510": "5473", "5511": "5474", "5512": "5475", "5513": "5476", "5514": "5477", "5515": "5478", "5516": "5479", "5517": "5480", "5518": "5481", "5519": "5482", "5520": "5483", "5521": "5484", "5522": "5485", "5523": "5486", "5524": "5487", "5525": "5488", "5526": "5489", "5527": "5490", "5528": "5491", "5529": "5492", "5530": "5493", "5531": "5494", "5532": "5495", "5533": "5496", "5534": "5497", "5535": "5498", "5536": "5499", "5537": "5500", "5540": "5501", "5541": "5502", "5542": "5503", "5543": "5504", "5544": "5505", "5545": "5506", "5546": "5507", "5547": "5508", "5548": "5509", "5549": "5510", "5550": "5511", "5551": "5512", "5552": "5513", "5553": "5514", "5554": "5515", "5555": "5516", "5556": "5517", "5557": "5518", "5558": "5519", "5559": "5520", "5560": "5521", "5561": "5522", "5562": "5523", "5563": "5524", "5564": "5525", "5565": "5526", "5566": "5527", "5567": "5528", "5568": "5529", "5569": "5530", "5570": "5531", "5571": "5532", "5572": "5533", "5573": "5534", "5574": "5535", "5575": "5536", "5576": "5537", "5577": "5538", "5578": "5539", "5579": "5540", "5580": "5541", "5581": "5542", "5582": "5543", "5583": "5544", "5584": "5545", "5585": "5546", "5586": "5547", "5587": "5548", "5588": "5549", "5589": "5550", "5590": "5551", "5593": "5552", "5594": "5553", "5595": "5554", "5596": "5555", "5597": "5556", "5598": "5557", "5599": "5558", "5600": "5559", "5601": "5560", "5602": "5561", "5603": "5562", "5604": "5563", "5605": "5564", "5606": "5565", "5607": "5566", "5608": "5567", "5609": "5568", "5610": "5569", "5611": "5570", "5612": "5571", "5613": "5572", "5614": "5573", "5615": "5574", "5616": "5575", "5617": "5576", "5618": "5577", "5619": "5578", "5620": "5579", "5621": "5580", "5622": "5581", "5623": "5582", "5624": "5583", "5626": "5584", "5627": "5585", "5628": "5586", "5629": "5587", "5630": "5588", "5631": "5589", "5632": "5590", "5633": "5591", "5634": "5592", "5635": "5593", "5636": "5594", "5637": "5595", "5638": "5596", "5639": "5597", "5640": "5598", "5641": "5599", "5642": "5600", "5643": "5601", "5644": "5602", "5645": "5603", "5650": "5604", "5651": "5605", "5652": "5606", "5653": "5607", "5654": "5608", "5657": "5609", "5658": "5610", "5659": "5611", "5660": "5612", "5661": "5613", "5662": "5614", "5663": "5615", "5665": "5616", "5666": "5617", "5667": "5618", "5668": "5619", "5671": "5620", "5673": "5621", "5674": "5622", "5675": "5623", "5677": "5624", "5678": "5625", "5679": "5626", "5680": "5627", "5683": "5628", "5684": "5629", "5685": "5630", "5686": "5631", "5687": "5632", "5688": "5633", "5689": "5634", "5694": "5635", "5695": "5636", "5696": "5637", "5697": "5638", "5698": "5639", "5699": "5640", "5700": "5641", "5701": "5642", "5702": "5643", "5705": "5644", "5706": "5645", "5707": "5646", "5708": "5647", "5709": "5648", "5710": "5649", "5711": "5650", "5712": "5651", "5713": "5652", "5714": "5653", "5715": "5654", "5716": "5655", "5717": "5656", "5718": "5657", "5719": "5658", "5720": "5659", "5721": "5660", "5722": "5661", "5723": "5662", "5724": "5663", "5725": "5664", "5726": "5665", "5727": "5666", "5728": "5667", "5729": "5668", "5730": "5669", "5735": "5670", "5736": "5671", "5737": "5672", "5738": "5673", "5739": "5674", "5740": "5675", "5741": "5676", "5742": "5677", "5743": "5678", "5744": "5679", "5745": "5680", "5746": "5681", "5747": "5682", "5748": "5683", "5749": "5684", "5750": "5685", "5751": "5686", "5752": "5687", "5753": "5688", "5754": "5689", "5755": "5690", "5756": "5691", "5757": "5692", "5758": "5693", "5759": "5694", "5760": "5695", "5761": "5696", "5762": "5697", "5763": "5698", "5764": "5699", "5765": "5700", "5766": "5701", "5767": "5702", "5768": "5703", "5769": "5704", "5770": "5705", "5771": "5706", "5772": "5707", "5773": "5708", "5774": "5709", "5775": "5710", "5776": "5711", "5777": "5712", "5778": "5713", "5779": "5714", "5780": "5715", "5781": "5716", "5782": "5717", "5783": "5718", "5784": "5719", "5785": "5720", "5786": "5721", "5787": "5722", "5788": "5723", "5789": "5724", "5790": "5725", "5791": "5726", "5792": "5727", "5793": "5728", "5794": "5729", "5795": "5730", "5798": "5731", "5799": "5732", "5800": "5733", "5801": "5734", "5802": "5735", "5803": "5736", "5804": "5737", "5805": "5738", "5806": "5739", "5807": "5740", "5812": "5741", "5813": "5742", "5814": "5743", "5815": "5744", "5816": "5745", "5817": "5746", "5818": "5747", "5819": "5748", "5820": "5749", "5821": "5750", "5822": "5751", "5823": "5752", "5824": "5753", "5825": "5754", "5826": "5755", "5827": "5756", "5828": "5757", "5829": "5758", "5830": "5759", "5831": "5760", "5832": "5761", "5833": "5762", "5834": "5763", "5835": "5764", "5836": "5765", "5837": "5766", "5838": "5767", "5839": "5768", "5840": "5769", "5841": "5770", "5842": "5771", "5843": "5772", "5847": "5773", "5848": "5774", "5849": "5775", "5850": "5776", "5851": "5777", "5852": "5778", "5853": "5779", "5854": "5780", "5855": "5781", "5856": "5782", "5857": "5783", "5858": "5784", "5859": "5785", "5860": "5786", "5861": "5787", "5863": "5788", "5864": "5789", "5865": "5790", "5870": "5791", "5871": "5792", "5872": "5793", "5873": "5794", "5874": "5795", "5875": "5796", "5876": "5797", "5877": "5798", "5878": "5799", "5879": "5800", "10000": "10001", "10001": "10002", "10002": "10003", "10003": "10004", "10004": "10005", "10005": "10006", "10006": "10007", "10007": "10008", "10008": "10009", "10009": "10010", "10010": "10012", "10012": "10013", "10013": "10014", "10014": "10016", "10016": "10017", "10017": "10018", "10018": "10019", "10019": "10020", "10020": "10021", "10021": "10022", "10022": "10023", "10023": "10024", "10024": "10025", "10025": "10026", "10026": "10027", "10027": "10028", "10028": "10029", "10029": "10030", "10030": "10031", "10031": "10032", "10032": "10033", "10033": "10034", "10034": "10035", "10035": "10036", "10036": "10037", "10037": "10038", "10038": "10039", "10039": "10040", "10040": "10041", "10041": "10042", "10042": "10043", "10043": "10044", "10044": "10045", "10045": "10046", "10046": "10047", "10047": "10048", "10048": "10050", "10050": "10051", "10051": "10052", "10052": "10053", "10053": "10054", "10054": "10057", "10057": "10058", "10058": "10059", "10059": "10060", "10060": "10061", "10061": "10062", "10062": "10063", "10063": "10064", "10064": "10065", "10065": "10066", "10066": "10067", "10067": "10068", "10068": "10069", "10069": "10070", "10070": "10071", "10071": "10072", "10072": "10073", "10073": "10074", "10074": "10075", "10075": "10078", "10078": "10080", "10080": "10082", "10082": "10083", "10083": "10084", "10084": "10085", "10085": "10086", "10086": "10087", "10087": "10088", "10088": "10089", "10089": "10090", "10090": "10091", "10091": "10092", "10092": "10093", "10093": "10094", "10094": "10095", "10095": "10096", "10096": "10097", "10097": "10098", "10098": "10099", "10099": "10100", "10100": "10101", "10101": "10102", "10102": "10103", "10103": "10104", "10104": "10105", "10105": "10106", "10106": "10107", "10107": "10108", "10108": "10109", "10109": "10110", "10110": "10111", "10111": "10112", "10112": "10113", "10113": "10114", "10114": "10115", "10115": "10116", "10116": "10119", "10119": "10123", "10123": "10124", "10124": "10125", "10125": "10126", "10126": "10127", "10127": "10128", "10128": "10129", "10129": "10130", "10130": "10132", "10132": "10133", "10133": "10134", "10134": "10135", "10135": "10136", "10136": "10137", "10137": "10138", "10138": "10139", "10139": "10140", "10140": "10141", "10141": "10142", "10142": "10143", "10143": "10144", "10144": "10145", "10145": "10146", "10146": "10147", "10147": "10148", "10148": "10149", "10149": "10150", "10150": "10151", "10151": "10152", "10152": "10153", "10153": "10154", "10154": "10155", "10155": "10156", "10156": "10157", "10157": "10158", "10158": "10159", "10159": "10160", "10160": "10161", "10161": "10163", "10163": "10164", "10164": "10165", "10165": "10166", "10166": "10167", "10167": "10168", "10168": "10169", "10169": "10171", "10171": "10172", "10172": "10173", "10173": "10174", "10174": "10175", "10175": "10177", "10177": "10178", "10178": "10179", "10179": "10180", "10180": "10181", "10181": "10182", "10182": "10183", "10183": "10184", "10184": "10185", "10185": "10186", "10186": "10190", "10190": "10191", "10191": "10192", "10192": "10194", "10194": "10195", "10195": "10196", "10196": "10197", "10197": "10198", "10198": "10199", "10199": "10200", "10200": "10201", "10201": "10202", "10202": "10203", "10203": "10204", "10204": "10205", "10205": "10206", "10206": "10207", "10207": "10210", "10210": "10211", "10211": "10212", "10212": "10213", "10213": "10214", "10214": "10215", "10215": "10216", "10216": "10217", "10217": "10218", "10218": "10219", "10219": "10220", "10220": "10221", "10221": "10222", "10222": "10223", "10223": "10224", "10224": "10225", "10225": "10226", "10226": "10227", "10227": "10228", "10228": "10229", "10229": "10230", "10230": "10231", "10231": "10232", "10232": "10233", "10233": "10234", "10234": "10235", "10235": "10236", "10236": "10237", "10237": "10238", "10238": "10239", "10239": "10240", "10240": "10241", "10241": "10242", "10242": "10243", "10243": "10244", "10244": "10245", "10245": "10246", "10246": "10247", "10247": "10248", "10248": "10249", "10249": "10250", "10250": "10251", "10251": "10252", "10252": "10253", "10253": "10254", "10254": "10255", "10255": "10256", "10256": "10257", "10257": "10258", "10258": "10259", "10259": "10260", "10260": "10261", "10261": "10262", "10262": "10264", "10264": "10265", "10265": "10266", "10266": "10267", "10267": "10268", "10268": "10270", "10270": "10271", "10271": "10272", "10272": "10273", "10273": "10274", "10274": "10275", "10275": "10276", "10276": "10277", "10277": "10278", "10278": "10279", "10279": "10280", "10280": "10281", "10281": "10282", "10282": "10283", "10283": "10284", "10284": "10285", "10285": "10286", "10286": "10287", "10287": "10288", "10288": "10289", "10289": "10290", "10290": "10291", "10291": "10292", "10292": "10293", "10293": "10294", "10294": "10296", "10296": "10297", "10297": "10298", "10298": "10299", "10299": "10300", "10300": "10301", "10301": "10302", "10302": "10303", "10303": "10304", "10304": "10305", "10305": "10306", "10306": "10307", "10307": "10308", "10308": "10310", "10310": "10311", "10311": "10312", "10312": "10313", "10313": "10314", "10314": "10315", "10315": "10316", "10316": "10317", "10317": "10318", "10318": "10319", "10319": "10320", "10320": "10321", "10321": "10322", "10322": "10323", "10323": "10324", "10324": "10325", "10325": "10326", "10326": "10327", "10327": "10328", "10328": "10329", "10329": "10330", "10330": "10331", "10331": "10332", "10332": "10333", "10333": "10334", "10334": "10335", "10335": "10336", "10336": "10337", "10337": "10338", "10338": "10339"}

formId = "31571110-483c-4b72-b4b8-5b1ce0b9348b"

client = boto3.client("ses")
responses = boto3.resource('dynamodb').Table("cff_prod.responses")

print("Querying all responses...")
responses = get_all_responses(KeyConditionExpression=Key('formId').eq(formId), FilterExpression=Key('PAID').eq(True))
print("Got responses.")

for rNum, response in enumerate(responses):
  print(f"=== Starting response number {rNum} ===")
  for i, participant in enumerate(get(response, "value.participants", [])):
    oldbib = str(get(participant, "bib_number"))
    if oldbib in BIBS and BIBS[oldbib] != oldbib:
      newbib = BIBS[oldbib]
      path = f"#value.participants[{i}].bib_number"
      print(path)
      res = TABLES.responses.update_item(
        Key=dict(formId=formId, responseId=response["responseId"]),
        UpdateExpression= f"SET {path} = :value,"
            "UPDATE_HISTORY = list_append(if_not_exists(UPDATE_HISTORY, :empty_list), :updateHistory),"
            "date_last_modified = :now",
        ExpressionAttributeValues={
            ":value": newbib,
            ":now": datetime.datetime.now().isoformat(),
            ':updateHistory': [{
                "date": datetime.datetime.now().isoformat(),
                "action": "admin_update_ResponsesEdit",
                "author": "cff:admin:manualScript",
                "path": path,
                "oldValue": oldbib,
                "value": newbib
            }],
            ":empty_list": []
        },
        ExpressionAttributeNames={"#value": "value"},
        ReturnValues="ALL_NEW"
      )["Attributes"]
      print(f"Updated response {response['responseId']} participant # {i} bib number {oldbib} to {newbib}")
print("Done! Duplicates:")
print(duplicate_bibs)